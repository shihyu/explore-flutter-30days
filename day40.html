<!DOCTYPE HTML>
<html lang="zh-TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Day 40ï¼šç‡šï¼æ­ç§˜ Source Genï½œFlutter ä»£ç¢¼ç”Ÿæˆ - Flutter éµäººè³½ 60 å¤©åˆè¼¯ï¼šç”±è£¡åˆ°å¤– Ã— é€²æ“Šä¹‹è·¯</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Flutter éµäººè³½ 60 å¤©åˆè¼¯ï¼šç”±è£¡åˆ°å¤– Ã— é€²æ“Šä¹‹è·¯</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="day-40ç‡šæ­ç§˜-source-genflutter-ä»£ç¢¼ç”Ÿæˆ"><a class="header" href="#day-40ç‡šæ­ç§˜-source-genflutter-ä»£ç¢¼ç”Ÿæˆ">Day 40ï¼šç‡šï¼æ­ç§˜ Source Genï½œFlutter ä»£ç¢¼ç”Ÿæˆ</a></h1>
<blockquote>
<p>åŸæ–‡ä¾†æºï¼š<a href="https://ithelp.ithome.com.tw/articles/10328283">Day 10ï¼šç‡šï¼æ­ç§˜ Source Genï½œFlutter ä»£ç¢¼ç”Ÿæˆ</a></p>
</blockquote>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘æ·±å…¥æ¢ç´¢äº† Flutter ä¸­çš„ Metadataï¼Œä»‹ç´¹äº†è¨±å¤šæœ‰è¶£çš„ Annotationã€‚ç•¶ç„¶ï¼Œå…‰æ˜¯äº†è§£ Metadata åªæ˜¯å†°å±±ä¸€è§’ï¼Œä»Šå¤©æˆ‘å€‘è¦ç¹¼çºŒæ·±æŒ–ï¼Œå¸¶å¤§å®¶èªè­˜ Flutter ä¸­å¦ä¸€å€‹å¼·å¤§çš„å·¥å…·â€”â€” <code>source_gen</code>ã€‚</p>
<h2 id="å¼•è¨€"><a class="header" href="#å¼•è¨€">å¼•è¨€:</a></h2>
<p>å“ˆå›‰ï¼å„ä½ Flutter æ„›å¥½è€…ï¼Œé‚„è¨˜å¾—æˆ‘å€‘ä¸Šæ¬¡æåˆ°ï¼Œè¦è®“è‡ªå·±çš„ Annotation ç”¢ç”Ÿå¯¦éš›çš„å½±éŸ¿ï¼Œéœ€è¦é…åˆ <code>GeneratorForAnnotation</code> å—ï¼Ÿé‚£éº¼é€™æ¬¡ï¼Œæˆ‘å€‘å°±ä¾†æ·±å…¥ç­è§£é€™å€‹èˆ‡å…¶ç›¸é—œçš„ library - <code>source_gen</code>ï¼Œå®ƒå¦‚ä½•å”åŠ©æˆ‘å€‘è‡ªå‹•ç”Ÿæˆä»£ç¢¼ï¼Œä»¥åŠå…¶å¼·å¤§çš„æ‡‰ç”¨å ´æ™¯ã€‚</p>
<p>é¦–å…ˆï¼Œè®“æˆ‘å€‘ç†è§£ <code>source_gen</code> æ˜¯ä»€éº¼ã€‚å®ƒæ˜¯ Dart çš„ä¸€å€‹ä»£ç¢¼ç”Ÿæˆå·¥å…·ï¼Œä¸¦é Flutter ç¨æœ‰ï¼Œä¸»è¦ç”¨æ–¼æ§‹å»º Annotations å’Œç”Ÿæˆå™¨ã€‚å®ƒå¯ä»¥è‡ªå‹•ç‚ºæˆ‘å€‘ç”Ÿæˆå¸¸è¦‹çš„æ¨¡æ¿ä»£ç¢¼ï¼Œæ¸›å°‘æ‰‹å‹•ç·¨å¯«çš„å†—é¤˜ã€‚</p>
<h3 id="å¦‚ä½•é‹ä½œ"><a class="header" href="#å¦‚ä½•é‹ä½œ">å¦‚ä½•é‹ä½œ</a></h3>
<p>ç•¶æˆ‘å€‘ç‚ºæŸå€‹ç‰¹å®šçš„é¡æˆ–å‡½æ•¸æ·»åŠ  Annotation å¾Œï¼Œ<code>source_gen</code> æœƒåŸºæ–¼é€™äº› Annotation å’Œç›¸å°æ‡‰çš„ç”Ÿæˆå™¨ï¼Œè‡ªå‹•ç‚ºæˆ‘å€‘ç”¢ç”Ÿç›¸æ‡‰çš„ç¨‹å¼ç¢¼ã€‚ä¾‹å¦‚ï¼Œæœ‰äº† <code>json_serializable</code>ï¼Œæˆ‘å€‘å°±ä¸éœ€è¦æ‰‹å‹•ç·¨å¯« JSON çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç¢¼äº†ï¼Œé€™ä¸€åˆ‡éƒ½å¯ä»¥ç”± <code>source_gen</code> å¹«æˆ‘å€‘å®Œæˆã€‚é‚£æ¥ä¸‹ä¾†æˆ‘å€‘å°±ä¾†è‡ªå·±å‹•æ‰‹å¯«çœ‹çœ‹è‡ªå‹•åŒ–ä»£ç¢¼ç”Ÿæˆå§ï¼</p>
<h3 id="åŸºæœ¬çš„ä½¿ç”¨"><a class="header" href="#åŸºæœ¬çš„ä½¿ç”¨">åŸºæœ¬çš„ä½¿ç”¨</a></h3>
<p>è¦ä½¿ç”¨ <code>source_gen</code>ï¼Œæˆ‘å€‘é¦–å…ˆéœ€è¦åœ¨ <code>pubspec.yaml</code> ä¸­æ·»åŠ ç›¸æ‡‰çš„ä¾è³´ã€‚å¦‚æœåªæ˜¯è‡ªå·±é–‹ç™¼ä½¿ç”¨å¯ä»¥æ”¾åœ¨ <code>dev_dependencies</code>ï¼Œå¦‚æœæ˜¯è¦å¯«æˆ package æä¾›çµ¦å…¶ä»–äººç”¨ï¼Œè¨˜å¾—æ”¾åœ¨ <code>dependencies</code> å“¦ï¼</p>
<pre><code class="language-yaml">dependencies:
flutter:
sdk: flutter

dev_dependencies:
build_runner: ^2.0.0
source_gen: ^1.0.0

</code></pre>
<p>æ¥è‘—ï¼Œåœ¨ä½ çš„ Dart æª”æ¡ˆä¸­æ–°å¢ Annotationsï¼Œå¦‚åŒä¸Šä¸€ç¯‡è«‡åˆ°çš„ Annotation å¯ä»¥æ˜¯ä»»ä½•ä¸€å€‹ classï¼Œé€™è£¡çš„å‘½åå¯ä»¥è‡ªå·±æ±ºå®šï¼Œæˆ‘å€‘å°±å…ˆå–æœ€ç°¡å–®çš„ <code>TestMetadata</code>ã€‚</p>
<pre><code class="language-dart">class TestMetaData {
const TestMetaData();
}

</code></pre>
<p>å†ä¾†å¯«ä¸€å€‹ <code>test.dart</code>ï¼Œä»–æœƒè¢«åŠ ä¸Š Annotation ï¼Œä¸¦åœ¨ç¨å¾Œè¢«åŠ ä¸Šç”Ÿæˆçš„ç¨‹å¼ç¢¼ï¼Œä½œç‚ºé€™æ¬¡æ¸¬è©¦çš„å°è±¡</p>
<pre><code class="language-dart">import 'package:flutter_day_10_build_runner/test_annotation.dart';

@TestMetaData("doraralab")
class MyClass {}

</code></pre>
<p>å®Œæˆ Annotation å¾Œï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†å¯«æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¦‚ä½•è§£æé€™å€‹ Annotationã€‚é¦–å…ˆæ–°å¢ä¸€å€‹ TestGenerator çš„æª”æ¡ˆï¼Œé€™è£¡éœ€è¦ extends <code>GeneratorForAnnotation</code>ï¼Œç”¨ä¾†å‘Šè¨´ build runner æˆ‘å€‘è¦è§£æçš„ Annotation æ˜¯ä»€éº¼ ï¼Œä¸¦ä¸”æ‡‰è©²è¦å¦‚ä½•ç”Ÿæˆç¨‹å¼ç¢¼ã€‚</p>
<p>ç•¶ä¸­ <code>generateForAnnotatedElement</code> æ˜¯å¿…é ˆå¯¦ä½œçš„å‡½æ•¸ï¼Œè£¡é¢åŒ…å«ä¸‰å€‹åƒæ•¸ <code>element</code>, <code>annotation</code>, <code>buildStep</code>ï¼Œç¨å¾Œæœƒå†ä¾†è¬›è§£ä»–å€‘æœ‰ä»€éº¼ä½œç”¨ã€‚ç¾åœ¨åªé—œæ³¨æ–¼ä»–æœ€å¾Œç”¢ç”Ÿçš„çµæœï¼šç”Ÿæˆ <code>class TestMetaDataFromGenerator{}</code>çš„ç¨‹å¼ç¢¼ã€‚</p>
<pre><code class="language-dart">import 'package:flutter_day_10_build_runner/test_annotation.dart';
import 'package:source_gen/source_gen.dart';

class TestGenerator extends GeneratorForAnnotation {
@override
generateForAnnotatedElement(element, annotation, buildStep) {
/// ç”Ÿæˆä»¥ä¸‹ç¨‹å¼
return "class TestMetaDataFromGenerator{}";
}
}

</code></pre>
<p>ç„¶å¾Œå»ºç«‹ä¸€å€‹ Builderï¼Œç”¨ä¾†å‘ŠçŸ¥ Build Runner æœ‰å“ªäº› Generator éœ€è¦å»æª¢æŸ¥ï¼Œéœ€è¦ç‰¹åˆ¥æ³¨æ„ <code>Builder</code>ï¼Œæ˜¯å¼•ç”¨è‡ª <code>'package:build/build.dart'</code>ï¼Œå¯ä¸æ˜¯æˆ‘å€‘å¹³å¸¸ä½¿ç”¨çš„ <code>material.dart</code>ã€‚</p>
<p>ç¾åœ¨æ”¯æ´çš„ Builder æœ‰ä¸‰ç¨®ï¼Œåˆ†åˆ¥æ˜¯ <code>PartBuilder</code>ã€<code>LibraryBuilder</code> å’Œ <code>SharedPartBuilder</code>ã€‚ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>PartBuilder</strong>:<code>PartBuilder</code> æ‡‰è©²æ˜¯æˆ‘å€‘æœ€å¸¸æœƒç¢°åˆ°çš„ï¼Œå¦‚ <code>json_annotation</code> ç”Ÿæˆçš„æª”æ¡ˆã€‚å®ƒç”¨æ–¼ç”Ÿæˆéƒ¨åˆ†ä»£ç¢¼æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ <code>.g.dart</code> æ–‡ä»¶ï¼‰ã€‚ç•¶ä½ çœ‹åˆ°å¦‚ä¸‹è¨»è§£æ™‚ï¼Œé€™è¡¨ç¤ºé€™å€‹æ–‡ä»¶æ˜¯ç”±å…¶ä»–ç”Ÿæˆå™¨ç”¢ç”Ÿçš„ï¼š</li>
</ul>
<pre><code class="language-dart">part 'filename.g.dart';

</code></pre>
<p>ä½¿ç”¨ <code>PartBuilder</code> æ™‚ï¼Œé¦–å…ˆéœ€è¦ç¢ºå®šä½ çš„åŸå§‹æ–‡ä»¶å·²ç¶“åŒ…å«äº†é€™å€‹ <code>part</code> è¨»è§£ã€‚ç„¶å¾Œä½¿ç”¨ <code>PartBuilder</code> å®šç¾©ä½ çš„ç”Ÿæˆå™¨ï¼š</p>
<pre><code class="language-dart">import 'package:source_gen/source_gen.dart';
import 'package:build/build.dart';

Builder myBuilder(BuilderOptions options) =&gt;
PartBuilder([MyGenerator()], '.g.dart');

</code></pre>
<ul>
<li><strong>LibraryBuilder</strong>:<code>LibraryBuilder</code> ç”¨æ–¼ç”Ÿæˆä¸€å€‹å®Œæ•´çš„åº«æ–‡ä»¶ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†æ–‡ä»¶ã€‚ç•¶ä½¿ç”¨ <code>LibraryBuilder</code> æ™‚ï¼Œä¸éœ€è¦ <code>part</code> è¨»è§£ï¼Œå› ç‚ºå®ƒæœƒç”Ÿæˆä¸€å€‹å®Œæ•´çš„æ–°æ–‡ä»¶ã€‚</li>
</ul>
<pre><code class="language-dart">Builder myLibraryBuilder(BuilderOptions options) =&gt;
LibraryBuilder(MyGenerator(), generatedExtension: '.mygenerator.dart');

</code></pre>
<ul>
<li><strong>SharedPartBuilder</strong>:<code>SharedPartBuilder</code> å…è¨±å¤šå€‹ç”Ÿæˆå™¨å…±äº«åŒä¸€å€‹éƒ¨åˆ†æ–‡ä»¶ã€‚é€™åœ¨ä½ å¸Œæœ›å°‡å¤šå€‹ç”Ÿæˆå™¨çš„è¼¸å‡ºæ”¾å…¥åŒä¸€å€‹ <code>.g.dart</code> æ–‡ä»¶æ™‚éå¸¸æœ‰ç”¨ã€‚</li>
</ul>
<pre><code class="language-dart">Builder sharedBuilder(BuilderOptions options) =&gt;
SharedPartBuilder([MyGenerator()], 'shared_part');

</code></pre>
<p>é€™è£¡åªåšç°¡å–®çš„ç¤ºç¯„ï¼Œæ‰€ä»¥é¸æ“‡æœ€å®¹æ˜“åšçš„ <code>LibraryBuilder</code>ï¼Œä¸¦å¡«å…¥åœ¨ä¸Šé¢å®Œæˆçš„ <code>TestGenerator</code> å°±å®Œæˆæ‘Ÿï¼</p>
<pre><code class="language-dart">import 'package:build/build.dart';
import 'package:flutter_day_10_build_runner/generator.dart';
import 'package:source_gen/source_gen.dart';

Builder testBuilder(options) =&gt; LibraryBuilder(TestGenerator());

</code></pre>
<p>çµ‚æ–¼ä¾†åˆ°æœ€å¾Œä¸€æ­¥é…ç½®ï¼Œç‚ºäº†è¦è·‘å‹• Build Runner æˆ‘å€‘å¿…é ˆè¦æ–°å¢ä¸€å€‹ <code>build.yaml</code> åˆ°æ ¹ç›®éŒ„ï¼Œç„¶å¾Œå¡«ä¸Šç›¸æ‡‰çš„é…ç½®ï¼š</p>
<p>import è¦æ ¹æ“šä¸Šé¢çš„ <code>testBuilder</code> çš„ä½ç½®è‡ªè¡Œä¿®æ”¹å“¦</p>
<pre><code class="language-yaml">builders:
testBuilder:
# builder æ‰€åœ¨è™•
import: 'package:your_package_name/builder.dart'
# æœ‰å“ªäº› builder æ–¹æ³•
builder_factories: ['testBuilder']
# ç”Ÿæˆçš„æ–°æ–‡ä»¶åç¼€
build_extensions: { '.dart': ['.g.part'] }
auto_apply: root_package
build_to: source

</code></pre>
<p>æœ€å¾Œï¼Œåªéœ€è¦åœ¨å‘½ä»¤è¡Œä¸­é‹è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘è‡ªå‹•åŒ–ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼æ‘Ÿï¼š</p>
<pre><code class="language-bash">flutter packages pub run build_runner build

</code></pre>
<p>å®Œæˆå¾Œå°±èƒ½çœ‹åˆ° <code>source_gen</code> åŸºæ–¼ä½ çš„ Annotations å’Œç”Ÿæˆå™¨ï¼Œç‚ºä½ ç”Ÿæˆ <code>test.g.dart</code> æ–‡ä»¶ ğŸ‰</p>
<pre><code class="language-dart">// GENERATED CODE - DO NOT MODIFY BY HAND

// **************************************************************************
// TestGenerator
// **************************************************************************

class TestMetaDataFromGenerator {}

</code></pre>
<p>åˆ°é€™é‚Šç›¸ä¿¡å¤§å®¶å·²ç¶“å° <code>source_gen</code> æ˜¯å¦‚ä½•é‹ä½œçš„æœ‰äº†åŸºç¤çš„äº†è§£ï¼Œæˆ‘å€‘å†å›åˆ° <code>TestMetaData</code> çš„éƒ¨åˆ†ï¼Œé€™æ¬¡æˆ‘å€‘åŠ ä¸Šä¸€é»å°è®ŠåŒ–ï¼Œè®“ <code>TestMetaData</code> æ˜¯å¯ä»¥åŠ å…¥åƒæ•¸çš„çš„ã€‚ä¾‹å¦‚æˆ‘å€‘åŠ ä¸Š <code>className</code> é€™å€‹åƒæ•¸ã€‚</p>
<pre><code class="language-dart">class TestMetaData {
final String className;
const TestMetaData(this.className);
}

</code></pre>
<p>ä¿®æ”¹ <code>test.dart</code>ï¼ŒåŠ ä¸Š <code>className</code></p>
<pre><code class="language-dart">import 'package:flutter_day_10_build_runner/test_annotation.dart';

@TestMetaData("doraralab")
class MyClass {}

</code></pre>
<p>é€™æ¬¡æˆ‘å€‘è¦é‡å° generator åšä¸€äº›ä¿®æ”¹ï¼Œè®“ä»–å¯ä»¥å»è®€æ‡‚ <code>TestMetaData</code>ï¼Œä¸¦å–å‡º <code>className</code> è®“æˆ‘å€‘ä½¿ç”¨ã€‚é€™è£¡å°±ä¾†è£œå……å‰›å‰›è¦è£œå……çš„ <code>element</code>, <code>annotation</code>, <code>buildStep</code>ã€‚</p>
<ul>
<li>
<p><strong><code>element</code></strong>ï¼šè¡¨ç¤ºè¢«è¨»è§£çš„å…ƒç´ ã€‚æˆ‘å€‘å¯ä»¥é€šé <code>element.kind</code> çŸ¥é“è¢«ä½ è¨»è§£çš„å…ƒç´ æ˜¯ class æˆ–æ˜¯ function ç”šè‡³å¯èƒ½æ˜¯ enum ï¼Œä¸ç®¡æ˜¯å“ªä¸€ç¨®éƒ½æœ‰å°æ‡‰çš„ kindã€‚é€šé <code>element.displayName</code> å¯ä»¥æ‹¿åˆ°é€™å€‹è¢«è¨»è§£å…ƒç´ çš„åç¨±ï¼Œç°¡è€Œè¨€ä¹‹ä½ å¯ä»¥é€šéé€™å€‹åƒæ•¸ä¾†è¨ªå•æœ‰é—œè¢«è¨»è§£å…ƒç´ çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><strong><code>buildStep</code></strong>ï¼šç”¨ä¾†æ§åˆ¶å¯«å…¥èˆ‡è®€å–æª”æ¡ˆçš„åŠŸèƒ½ï¼Œé€™éƒ¨åˆ†æ¯”è¼ƒå°‘æ›´å‹•ã€‚</p>
</li>
<li>
<p><strong><code>annotation</code></strong>ï¼šé€™è£¡çš„ <code>annotation</code> å°±æ˜¯æˆ‘å€‘ä¸Šé¢æä¾›çš„ TestMetaDataï¼Œä¸éæˆ‘å€‘æ²’è¾¦æ³•ç›´æ¥æŠŠä»–ç•¶æˆ class çš„å¯¦é«”æ“ä½œï¼Œè€Œæ˜¯è¦é€é <code>.read</code> æˆ–æ˜¯ <code>.peek</code> çš„æ–¹æ³•ä¾†æ‹¿åˆ°å…§éƒ¨ parameter çš„å€¼ã€‚å…©å€‹ä¸åŒæ˜¯ <code>.read</code> å¦‚æœé‡åˆ°ä¸çŸ¥é“çš„åƒæ•¸æœƒæ‹‹å‡ºéŒ¯èª¤ï¼Œè€Œ <code>.peek</code> æœƒè¿”å› nullï¼Œä¸‹é¢ç›´æ¥çœ‹æˆ‘å€‘è¦æ›´æ”¹çš„ç¨‹å¼ç¢¼ã€‚</p>
</li>
</ul>
<pre><code class="language-dart">import 'package:flutter_day_10_build_runner/test_annotation.dart';
import 'package:source_gen/source_gen.dart';

class TestGenerator extends GeneratorForAnnotation {
@override
generateForAnnotatedElement(element, annotation, buildStep) {
// ç”¨ peek çš„è©±å°±è¦å» handle null çš„æƒ…æ³ï¼Œ.read å‰‡æ˜¯å¯ä»¥ç›´æ¥å™´éŒ¯è®“ build runner å¤±æ•—
return "class ${annotation.peek("className")?.stringValue ?? "Unknown"}{}";
}
}

</code></pre>
<p>é‡æ–°è·‘ <code>flutter packages pub run build_runner build</code>ï¼Œå°±å¯ä»¥æ‰¾åˆ°æˆ‘å€‘çš„ <code>test.g.dart</code>ï¼Œæˆç‚ºæˆ‘å€‘æƒ³è¦çš„çµæœæ‘Ÿï¼</p>
<pre><code class="language-dart">// GENERATED CODE - DO NOT MODIFY BY HAND

// **************************************************************************
// TestGenerator
// **************************************************************************

class doraralab {}

</code></pre>
<p>ğŸ’¡å°æç¤ºï¼šå¦‚æœä½ æ˜¯ä½¿ç”¨Â vscodeï¼Œæƒ³è¦ debug æ•´å€‹ build runner çš„éç¨‹ï¼Œå¯ä»¥æŠŠä¸‹é¢é€™æ®µåŠ å…¥åˆ°ä½ çš„ <code>launch.json</code>ï¼Œå°±å¯ä»¥çœ</p>
<pre><code class="language-dart">{
"name": "Debug  Generator",
"request": "launch",
"program": ".dart_tool/build/entrypoint/build.dart",
"type": "dart",
"args": ["build"]
},

</code></pre>
<h2 id="çµèª"><a class="header" href="#çµèª">çµèª:</a></h2>
<p>ä»£ç¢¼è‡ªå‹•ç”Ÿæˆä¸åƒ…å¯ä»¥ç‚ºé–‹ç™¼è€…çœå»å¤§é‡çš„æ™‚é–“ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒç¢ºä¿äº†ä»£ç¢¼çš„ä¸€è‡´æ€§å’Œå“è³ªã€‚é€é source_gen çš„ä½¿ç”¨ï¼Œæˆ‘å€‘èƒ½æ›´é«˜æ•ˆåœ°å®Œæˆæ—¥å¸¸çš„é–‹ç™¼å·¥ä½œï¼Œä¸¦é¿å…è¨±å¤šæ‰‹å·¥ç·¨å¯«ä»£ç¢¼æ™‚å¯èƒ½å‡ºç¾çš„éŒ¯èª¤ã€‚å¸Œæœ›é€™ç¯‡æ–‡ç« å¯ä»¥å¹«åŠ©ä½ æ›´æ·±å…¥åœ°äº†è§£ Flutter èƒŒå¾Œçš„å·¥å…·èˆ‡æŠ€å·§ï¼Œä¸¦æ¿€ç™¼ä½ é€²ä¸€æ­¥æ¢ç´¢å…¶å®ƒå¼·å¤§çš„åŠŸèƒ½ã€‚æœªä¾†çš„é–‹ç™¼ä¹‹è·¯ï¼Œé¡˜æˆ‘å€‘èƒ½æ›´å¿«ã€æ›´å¥½ã€æ›´å¼·!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="day39.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="day41.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="day39.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="day41.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
