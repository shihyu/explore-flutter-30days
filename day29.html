<!DOCTYPE HTML>
<html lang="zh-TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Day 29: Dart 3 總複習，大家準備一下待會考試！ - Flutter 鐵人賽 60 天合輯：由裡到外 × 進擊之路</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Flutter 鐵人賽 60 天合輯：由裡到外 × 進擊之路</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="day-29-dart-3-總複習大家準備一下待會考試"><a class="header" href="#day-29-dart-3-總複習大家準備一下待會考試">Day 29: Dart 3 總複習，大家準備一下待會考試！</a></h1>
<ul>
<li>發布時間：2023-10-14 15:37:51</li>
<li>原文連結：<a href="https://ithelp.ithome.com.tw/articles/10339438">https://ithelp.ithome.com.tw/articles/10339438</a></li>
<li>系列標記：探索 Flutter 由裡到外，三十天帶你前往進階系列 第 29 篇</li>
</ul>
<p><img src="images/20120687S7c66BJUBD.png" alt="" /></p>
<p>延續在本系列開始的 Dart 3 解說與實用範例，目的是希望系列結束前能再讓大家複習和更熟悉 Dart 3 新版帶來的方便性，有效運用在目前的專案上，甚至能優化以前的程式碼，相信它們能夠給予一定的協助。</p>
<p>Dart 3 相關文章：</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10319282">Day 1: 跟著我熟悉 Dart 3，這些高效語法你需要知道！</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10320379">Day 2: 使用 Dart 3 改善我們的開發習慣，更多範例與技巧分享！</a></li>
</ul>
<p>本文從第二篇的 Dart 3 文章接棒，繼續分享更多的實際案例與技巧，我們不只是要知道如何使用外，也要慢慢內化它，不靠死背記下來。而後面我也準備了小測驗，驗證大家對於 Dart 的熟悉程度，順便學習一些觀念。建議在閱讀文章的同時打開 IDE，同步跟著撰寫程式碼，這種方式學習速度會大大提升哦。</p>
<hr />
<h2 id="example-10"><a class="header" href="#example-10">Example 10</a></h2>
<ol>
<li>此範例使用了匿名參數、命名參數混合的 Record，在當中大家可以記住，前後順序可以隨便安排，不會影響使用方式。所以這裡使用了 <code>isMale</code> 命名參數，記得大括號包裹。</li>
<li>接著<strong>解構(Destructure)</strong> student 物件，一樣順序沒有關係，直接根據自定義的命名變數來存取就可以了</li>
</ol>
<pre><code class="language-dart">(int, String, {bool isMale}) student = (18, isMale: true, 'Yii');
print(student);
// (18, Yii, isMale: true)

final (isMale: isMale, age, name) = student;
print('$isMale, $age, $name');
// true, 18, Yii
</code></pre>
<h2 id="example-11"><a class="header" href="#example-11">Example 11</a></h2>
<p>這裡創建了一個方法 <code>waitTwoTask()</code>，返回一個 Record 結果，可以很簡單地處理多回傳值。以這個範例，當我有兩個非同步操作要同時處理時，就能使用 <code>waitTwoTask()</code> 協助我們，外部再順取兩個結果變數。</p>
<pre><code class="language-dart">final Future&lt;int&gt; futureAge = getAge();
final Future&lt;String&gt; futureName = getName();

final (int age, String name) = await waitTwoTask(futureAge, futureName);
print('$age, $name');
// 18, Yii

---

Future&lt;int&gt; getAge() async {
    return 18;
}

Future&lt;String&gt; getName() async {
    return 'Yii';
}

Future&lt;(T1, T2)&gt; waitTwoTask&lt;T1, T2&gt;(Future&lt;T1&gt; func1, Future&lt;T2&gt; func2) async {
    final data = await Future.wait([func1, func2]);

    return (data[0] as T1, data[1] as T2);
}
</code></pre>
<h2 id="example-12"><a class="header" href="#example-12">Example 12</a></h2>
<p>在 Dart 3 更新後，針對 Iterable 的 Extension 有在優化，新增了幾個常用 API，其中一個為 <code>indexed</code> getter，直接回傳一個 Record Iterable，內容為 index 和原有元素，多了索引讓我們在使用上更為方便。<br />
<img src="images/20120687c3o0BVQF0r.png" alt="" /></p>
<ol>
<li>此範例有一個 String List，透過 <code>indexed</code> 搭配 for loop，將每個 Record 拿出來處理</li>
<li>第二個其實做法一樣，只是透過迴圈幫我們創建 List Item，最後使用 forEach 印出結果</li>
</ol>
<pre><code class="language-dart">/// 1.
final students = ['Amy', 'Berry', 'Alan', 'Hank'];
for (final (index, element) in students.indexed) {
    print('$index, $element');
}
// 0, Amy
// 1, Berry
// 2, Alan
// 3, Hank

/// 2.
const names = ['Jack', 'Tina', 'Doodle'];
final result = [
    for (final (index, word) in names.indexed) '$index is $word',
];

result.forEach(print);
// 0 is Jack
// 1 is Tina
// 2 is Doodle
</code></pre>
<h2 id="example-13"><a class="header" href="#example-13">Example 13</a></h2>
<p>此範例使用到 <strong>Switch Expression</strong>，可以運用在日常的 Flutter 場景。目的是取得設備類型，所以首先有個 DeviceType enum，接著撰寫新的 BuildContext 擴充 API，根據目前的寬度根據每個設備條件來確認，完成一個 <code>deviceType</code> getter。接著在 UI code 就能透過 <code>deviceType</code> 處理每個場景。</p>
<pre><code class="language-dart">enum DeviceType {
  mobile,
  tablet,
  desktop,
  tv4k,
  giant,
}

extension BuildContextExtension on BuildContext {
    double get width =&gt; MediaQuery.sizeOf(this).width;

    DeviceType get deviceType =&gt; switch (width) {
        &lt; 450 =&gt; DeviceType.mobile,
        &lt; 800 =&gt; DeviceType.tablet,
        &lt; 2160 =&gt; DeviceType.desktop,
        &lt; 3840 =&gt; DeviceType.tv4k,
        _ =&gt; DeviceType.giant,
      };
}
</code></pre>
<p><img src="images/20120687CocGBdTeCY.png" alt="" /></p>
<h2 id="example-14"><a class="header" href="#example-14">Example 14</a></h2>
<p>使用 <strong>Switch Expression</strong>、<strong>Pattern Matching</strong> 和 <strong>Destructuring</strong>。此範例需要解析 Json 並取得指定的 title 字串， 其中檢查格式是否有 name 這個 Key，而且 Value 不是空值，這時候就安全地拿 title 來使用，否則就拋出例外。</p>
<pre><code class="language-dart">final jsonMap = {
    'student': {
        'name': 'Jay',
    }
};

final title = switch (jsonMap) {
    {'student': {'name': final String title}} =&gt; title,
    _ =&gt; throw Exception('JSON is not correct.'),
};

print(title);
// Jay
</code></pre>
<p><img src="images/20120687BbvDudeFbJ.png" alt="" /></p>
<h2 id="example-15"><a class="header" href="#example-15">Example 15</a></h2>
<p>在寫 UI 時，大家對於 <strong>FutureBuilder</strong> 應該非常熟悉，等待 future function 處理完後反應 UI，這時候針對 <strong>AsyncSnapshot</strong> 的各種狀態就能使用 Switch Expression 來協助，透過 when 進行第二層檢查，精簡、快速的處理成功、載入、錯誤三種情況，可讀性也因此提高了你說是吧。</p>
<pre><code class="language-dart">FutureBuilder&lt;String&gt;(
    future: Future.delayed(
        const Duration(seconds: 10),
        () {
            return 'Dart 3 is awesome.';
        },
    ),
    builder: (context, snapshot) =&gt; switch (snapshot) {
        final snapshot when snapshot.hasData =&gt; Text(snapshot.data ?? ''),
        final AsyncSnapshot&lt;String&gt; snapshot when !snapshot.hasError =&gt; const CircularProgressIndicator(),
        _ =&gt; const Text('Oops!')
  },
),
</code></pre>
<h2 id="example-16"><a class="header" href="#example-16">Example 16</a></h2>
<p>此範例使用 <strong>sealed Class</strong>、<strong>If-Case Matching</strong>、<strong>Destructuring</strong>，目的要快速的確認 sub class 並存取屬性。首先有一個 Car 跟 Tesla 兩個父子類別，經由 <code>getCar()</code> 取得子類別實體，這時候外部拿到的是 Car，需要檢查是否為我們要的 Tesla。</p>
<ol>
<li>第一個檢查，確認 Tesla，而且名稱為 Red，符合的話就印出 I am Red.。在這裡的情況都不會是 null</li>
<li>第二個跟第三個實際上一樣，差別只是解構時對於 name 屬性的宣告方式。這情境不限制字串內容，只需確保它是 Tesla 子類別就好，最後就是將 name 印出來</li>
</ol>
<pre><code class="language-dart">final car = getCar();
if (car case Tesla(name: 'Red')) {
    print('I am Red.');
} else if (car case Tesla(:final name)) {
    print('I am $name.');
    // I am Blue.
} else if (car case Tesla(name: final name)) {
    print('I am $name.');
    // I am Blue.
}

---

sealed class Car {
    final String name;
    Car(this.name);
}
    
class Tesla extends Car {
    Tesla(super.name);
}

Car getCar() {
    return Tesla('Blue');
}
</code></pre>
<h2 id="example-17"><a class="header" href="#example-17">Example 17</a></h2>
<p>從此圖範例可以表達 <strong>Switch Expression</strong> 的方便性，功用就跟 freezed 的 union-class 相同，針對多種情境和資料的使用方式都吃不啊多，透過 Dart 3 解構用法可以幫我們提高效率。<br />
<img src="images/20120687iBynqyNYds.png" alt="" /><br />
by Pascal Welsch</p>
<h2 id="example-18"><a class="header" href="#example-18">Example 18</a></h2>
<p>再次複習 <code>indexed</code> 新用法，有個 Map 需要有索引進行一些操作，搭配 for loop，在當中將每個 Item 轉成 Record 形式，並進行 MapEntry 解構，拿出 Key 名稱跟 Value 價格。在解構當中，方式不只一種，可以透**前綴:**取值，也可以透過命名參數取值，根據自己的使用習慣和規範。</p>
<pre><code class="language-dart">final cars = {
    'Tesla': 100,
    'Benz': 200,
    'BMW': 300,
};
for (final (index, MapEntry(:key, value: value)) in cars.entries.indexed) {
    print('$index - ($key, $value)');
}
// 0 - (Tesla, 100)
// 1 - (Benz, 200)
// 2 - (BMW, 300)
</code></pre>
<h2 id="quiz-小測驗"><a class="header" href="#quiz-小測驗">Quiz 小測驗</a></h2>
<h4 id="第一題"><a class="header" href="#第一題">第一題</a></h4>
<p>本題主要是考驗 <strong>Pattern Matching</strong> 中的 <strong>If-Case Matching</strong>，哪幾個 Pattern 會符合而且印出結果？</p>
<p>結果：</p>
<ul>
<li>實際上 1、2 很簡單的根據是否 nullable 來辨識，第二個會符合</li>
<li>接下來 3 的寫法，雖然沒有問號，但它其實是 nullable，所以會被執行</li>
<li>最後 4 有加上問號，不過它一定有值，不可 null，所以不被執行</li>
</ul>
<pre><code class="language-dart">int? age;

void main(List&lt;String&gt; arguments) {
    // 1.
    if (age case final int age) {
        printAge(age);
    }
    
    // 2.
    if (age case final int? age) {
        printAge(age);
    }
    
    // 3.
    if (age case final age) {
        printAge(age);
    }
    
    // 4.
    if (age case final age?) {
        printAge(age);
    }
}

void printAge(int age) {
    print('Age is $age.');
}
</code></pre>
<h4 id="第二題"><a class="header" href="#第二題">第二題</a></h4>
<p>對於以下的 <strong>Records</strong> 操作，它們個別印出什麼結果呢？</p>
<p>這個測驗過程很有趣，以 Record 來說，當我們有加上逗號，代表可能有多值要記錄，實際上就會是 Record，儘管只有一個參數。</p>
<pre><code class="language-dart">final one = 42;
print(one.runtimeType); // int

final one = (42);
print(one.runtimeType); // int

final two = (42,);
print(two.runtimeType); // (int)

final (int) two = (42,);
print(two.runtimeType); // (int)

final (int,) two = (42,);
print(two.runtimeType); // (int)
</code></pre>
<p>by Pascal Welsch</p>
<h4 id="第三題"><a class="header" href="#第三題">第三題</a></h4>
<p>對於以下的 <strong>Destructuring</strong> 操作，它們個別印出什麼結果呢？</p>
<p>首先提供一個 Record，它附有一個參數並多加了一個逗號誘導，當解構後的 Record 存取時，裡面的變數就是獨立的，在有逗號的情況下，元素就能期待它是原有型別。沒有逗號的情況下，取出的元素為 Record。</p>
<pre><code class="language-dart">final (int,) item = (42,);

final (one,) = item;
print(one.runtimeType); // int

final (two) = item;
print(two.runtimeType); // (int), Record!

final two = item;
print(two.runtimeType); // (int), Record!
</code></pre>
<p>by Pascal Welsch</p>
<hr />
<h2 id="總結"><a class="header" href="#總結">總結</a></h2>
<p>相信跟著操作過這些實際例子的你們，應該已經懂得如何正確使用新的語法特性，其實不會很難對吧。也建議有時間的話去閱讀官方文件以及 Dart Repository，裡面有更詳細的設計說明。而現在社群很多人也已經有提供相關的 Dart 3 文章和影片解說，可以的話也鼓勵把開發經驗跟大家分享，多看多練習，你才會發現 Dart 語言其實越來越豐富、越來越強大了。</p>
<h2 id="延伸閱讀"><a class="header" href="#延伸閱讀">延伸閱讀</a></h2>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10319282">Day 1: 跟著我熟悉 Dart 3，這些高效語法你需要知道！</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10320379">Day 2: 使用 Dart 3 改善我們的開發習慣，更多範例與技巧分享！</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="day28.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="day30.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="day28.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="day30.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
