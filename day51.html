<!DOCTYPE HTML>
<html lang="zh-TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Day 51ï¼šä¾†èŠèŠæ¸¬è©¦é€™ä»¶äº‹ï¼ˆä¸­ï¼‰ï½œMock Package  çš„æ·±å…¥æ¢ç´¢ - Flutter éµäººè³½ 60 å¤©åˆè¼¯ï¼šç”±è£¡åˆ°å¤– Ã— é€²æ“Šä¹‹è·¯</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Flutter éµäººè³½ 60 å¤©åˆè¼¯ï¼šç”±è£¡åˆ°å¤– Ã— é€²æ“Šä¹‹è·¯</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="day-51ä¾†èŠèŠæ¸¬è©¦é€™ä»¶äº‹ä¸­mock-package--çš„æ·±å…¥æ¢ç´¢"><a class="header" href="#day-51ä¾†èŠèŠæ¸¬è©¦é€™ä»¶äº‹ä¸­mock-package--çš„æ·±å…¥æ¢ç´¢">Day 51ï¼šä¾†èŠèŠæ¸¬è©¦é€™ä»¶äº‹ï¼ˆä¸­ï¼‰ï½œMock Package  çš„æ·±å…¥æ¢ç´¢</a></h1>
<blockquote>
<p>åŸæ–‡ä¾†æºï¼š<a href="https://ithelp.ithome.com.tw/articles/10335645">Day 21ï¼šä¾†èŠèŠæ¸¬è©¦é€™ä»¶äº‹ï¼ˆä¸­ï¼‰ï½œMock Package  çš„æ·±å…¥æ¢ç´¢</a></p>
</blockquote>
<p>æ˜¨å¤©ï¼Œæˆ‘å€‘èŠäº†ä¸€ä¸‹æ¸¬è©¦é©…å‹•é–‹ç™¼ï¼ˆTDDï¼‰çš„æ¦‚å¿µï¼Œäº†è§£åˆ°å®ƒä¸åƒ…åƒ…æ˜¯é—œæ–¼ã€Œæ€éº¼æ¸¬è©¦ã€ï¼Œæ›´å¤šçš„æ˜¯ã€Œæ€éº¼æ€è€ƒã€ã€‚å®ƒå‘Šè¨´æˆ‘å€‘ï¼Œé–‹ç™¼çš„éç¨‹å¯ä»¥æ›´æœ‰çµ„ç¹”ï¼Œæ›´æœ‰æ–¹å‘ã€‚</p>
<p>ä½†å¯«æ¸¬è©¦é€™ä»¶äº‹æƒ…ï¼Œä¸¦ç«Ÿé‚„æ˜¯æœ‰æ¯ç‡¥çš„æˆåˆ†åœ¨è£¡é¢ã€‚æ–¼æ˜¯ä»Šå¤©å°±ç›´æ¥æ•´ç†ä¸€ç¯‡å·¥å…·è£œå¸–ï¼Œä¾†çœ‹çœ‹æœ‰å“ªäº›æ–¹ä¾¿æœ‰è¶£çš„å·¥å…·å¯ä»¥å¹«åŠ©æˆ‘å€‘æ›´å¿«é€Ÿå®Œæˆæ¸¬è©¦çš„å·¥ä½œã€‚å¸Œæœ›å°å¤§å®¶æœ‰é»å¹«åŠ©ï¼</p>
<h2 id="1-fake-test-data"><a class="header" href="#1-fake-test-data">1. Fake Test Data</a></h2>
<h3 id="faker"><a class="header" href="#faker">Faker</a></h3>
<p>åœ¨è»Ÿé«”é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘ç¶“å¸¸éœ€è¦æ“æœ‰å¤§é‡è³‡æ–™ä¾†ç¢ºä¿åŠŸèƒ½çš„æ­£ç¢ºæ€§å’Œæ•ˆèƒ½ã€‚ä½†åœ¨åˆæœŸï¼Œæœ‰æ™‚æˆ‘å€‘å¯èƒ½ä¸å¸Œæœ›æˆ–ä¸èƒ½ä½¿ç”¨çœŸå¯¦çš„æ•¸æ“šï¼ˆæœ‰å¯èƒ½åªæ˜¯æ‡¶æƒ°ï¼‰ï¼Œé€™æ™‚å€™ <strong>Faker</strong> å°±ç™¼æ®äº†å®ƒçš„ä½œç”¨ã€‚</p>
<p>Faker ç”¨èµ·ä¾†ä¹Ÿç›¸ç•¶ç°¡å–®ï¼Œå¯ä»¥å¿«é€Ÿå¹«å¦³ç”Ÿæˆå„ç¨®æ¸¬è©¦è³‡æ–™ï¼Œéå¸¸æ–¹ä¾¿ï¼š</p>
<pre><code class="language-dart">import 'package:faker/faker.dart';

main() {
var faker = new Faker();

faker.internet.email();
// francisco_lebsack@buckridge.com

faker.internet.ipv6Address();
// 2450:a5bf:7855:8ce9:3693:58db:50bf:a105

faker.person.prefix();
// Mrs.

faker.lorem.sentence();
// Nec nam aliquam sem et
}

</code></pre>
<p>ç”±æ–¼æ–‡ä»¶ä¸Šæ²’æœ‰å¯«ä»–åˆ°åº•æ”¯æ´å“ªäº›å‡è³‡æ–™ç”Ÿæˆï¼Œé€™è£¡æŠ“å‡ºä»–çš„ç¨‹å¼ç¢¼çµ¦å¤§å®¶åƒè€ƒä¸€ä¸‹ã€‚</p>
<pre><code class="language-dart">â”œâ”€â”€ address.dart
â”œâ”€â”€ colors.dart
â”œâ”€â”€ company.dart
â”œâ”€â”€ conference.dart
â”œâ”€â”€ currency.dart
â”œâ”€â”€ date.dart
â”œâ”€â”€ food.dart
â”œâ”€â”€ geo.dart
â”œâ”€â”€ guid.dart
â”œâ”€â”€ image.dart
â”œâ”€â”€ internet.dart
â”œâ”€â”€ job.dart
â”œâ”€â”€ jwt.dart
â”œâ”€â”€ lorem.dart
â”œâ”€â”€ person.dart
â”œâ”€â”€ phone_number.dart
â”œâ”€â”€ random_generator.dart
â”œâ”€â”€ seed.dart
â”œâ”€â”€ sport.dart
â””â”€â”€ vehicle.dart

</code></pre>
<p>ç›®å‰ç”¨ä¸‹ä¾†å”¯ä¸€çš„å°å°ç¼ºé»å°±æ˜¯ä¸æ”¯æ´å¤šåœ‹èªç³»ï¼Œåªèƒ½ç”¢å‡ºè‹±èªçš„è³‡æ–™ï¼Œä¹Ÿè¨±æ—¥å¾Œå¯ä»¥æ PR å¹«å¿™è£œä¸Šã€‚</p>
<h2 id="2-test-auto-generator"><a class="header" href="#2-test-auto-generator">2. Test Auto Generator</a></h2>
<h3 id="walltested"><a class="header" href="#walltested">Walltested</a></h3>
<p>æœ€è¿‘çªç„¶ç™¼ç¾çš„é…·å·¥å…·ï¼Œå¯ä»¥é€é AI ç›´æ¥å¹«ä½ ç”Ÿæˆéœ€è¦æ¸¬è©¦çš„ç¨‹å¼ç¢¼ï¼Œç¾åœ¨æˆ‘é‚„æ²’æœ‰æŠŠä»–æŠ•å…¥ç”Ÿç”¢åŠ›å·¥å…·ï¼Œä¸éä»–çš„æ¦‚å¿µè »æœ‰è¶£çš„ç”¨èµ·ä¾†ä¹Ÿé‚„ä¸éŒ¯ï¼Œåœ¨é€™è£¡ä¸€ä½µæ¨è–¦çµ¦å¤§å®¶ç©ç©çœ‹ã€‚</p>
<p>å› ç‚ºä»–å€‘å®˜ç¶²çš„æ–‡ä»¶å’Œ pub.dev é‚„æœ‰ github çš„ <code>README.md</code> å±…ç„¶æœ‰ä¸‰ç¨®ä¸åŒçš„ setupï¼Œæ‰€ä»¥é€™ç²’é‚„æ˜¯æä¾›æˆ‘è‡ªå·±ç¸½çµä¸‹ä¾†å¯ä»¥çš„æ–¹æ³• ğŸŒ</p>
<p>ç¬¬ä¸€æ­¥è¦åˆ°å®˜ç¶²ç”³è«‹ API Keyï¼Œç›®å‰é–‹èµ·ä¾†æ˜¯å°é–‹ç™¼è€…å…è²»ï¼Œæ‰€ä»¥å¯ä»¥å…ˆä¸ç”¨éŒ¢ç©çœ‹çœ‹ã€‚API Key æœƒé€é email å¯„çµ¦ä½ ï¼Œå°±å…ˆæ”¶å¥½å¾…æœƒç”¨åˆ°ã€‚</p>
<p>é¦–å…ˆå®‰è£ walltestdï¼š</p>
<pre><code class="language-dart">dart pub global activate welltested

</code></pre>
<p>æ¥è‘—é€²å…¥åˆ°ä½ çš„ Flutter å°ˆæ¡ˆï¼Œä¸¦ä¸‹æŒ‡ä»¤ã€‚é€™å€‹æ­¥é©Ÿæœƒç›´æ¥å¹«æˆ‘å€‘åœ¨ pubspec.yaml è£ä¸Šéœ€è¦çš„ä¾è³´ï¼š</p>
<pre><code class="language-dart">welltested init

</code></pre>
<p>åœ¨æŒ‡ä»¤éç¨‹ä¸­æœƒè¦æ±‚ä½ æä¾›å‰›å‰›æ‹¿åˆ°çš„ API Key</p>
<p>æ¥ä¸‹ä¾†åˆ°éœ€è¦å¯«æ¸¬è©¦çš„ Classï¼Œå¹«ä»–æ‰“ä¸Š <code>@Welltested()</code> çš„ Annotationï¼Œå°±æœƒå¹«ä½ æŠŠç”¨åˆ°çš„æ–¹æ³•éƒ½è‡ªå‹•åŒ–ç”Ÿæˆæ¸¬è©¦ã€‚</p>
<p>å¦‚æœæœ‰æƒ³ç‰¹åˆ¥æŒ‡å®šæ¸¬è©¦æ¡ˆä¾‹ï¼Œå¯ä»¥åŠ ä¸Š <code>@Testcases</code> ï¼Œå‘Šè¨´ AI è¦å¦‚ä½•ç”Ÿæˆä½ çš„æ¸¬è©¦æ¡ˆä¾‹ã€‚</p>
<p>ç”šè‡³æ˜¯æƒ³è·³éå“ªäº›æ–¹æ³•ä¸å¯«æ¸¬è©¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@Welltested(excludedMethods: ['logOutUser'])</code>ï¼Œä¾†è·³éé€™äº›æ–¹æ³•</p>
<pre><code class="language-dart">import 'package:welltested_annotation/welltested_annotation.dart';

@Welltested()
class Auth {
String? randomStringVariable;
int? randomIntVariable;
double? randomDoubleVariable;

@Testcases(["if email is not email "])
Future loginWithEmailAndPassword(
{required String email, required String password}) async {
User user = User(uid: "123");
final currentUserId = user.uid;
if (currentUserId == "123") {
return User(uid: "123");
}
if (email.isEmpty || password.isEmpty) {
throw Exception("Email or Password can't be empty");
}
if (email == "test@test.com" &amp;&amp; password == "password") {
user = User(uid: "123456");
}
return user;
}

Future logoutUser() async {
//Add Logout Functionality
}
}

class User {
final String uid;
User({required this.uid});
}

</code></pre>
<p>é€šé€šéƒ½è¨­å®šå®Œæˆä¹‹å¾Œï¼Œå°±å¯ä»¥é–‹å§‹ç”Ÿæˆ Unit test</p>
<pre><code class="language-dart">welltested generate unit

</code></pre>
<p>ç¶“éä¸€å°æ®µæ™‚é–“çš„ç­‰å€™ï¼Œå°±å¯ä»¥çœ‹åˆ° test è³‡æ–™å¤¾åº•ä¸‹ï¼Œå·²ç¶“è‡ªå‹•å¹«æˆ‘å€‘ç”Ÿæˆæ‰€éœ€è¦çš„ç¨‹å¼ç¢¼æ‘Ÿï¼Œä»–æœƒå¹«ä½ ä»¥ class ç•¶ä½œè³‡æ–™å¤¾çš„åç¨±ï¼Œè£¡é¢çš„æª”æ¡ˆå‰‡æ˜¯æ¯å€‹éœ€è¦æ¸¬è©¦çš„æ–¹æ³•ã€‚é€™è£¡é™„ä¸Šæœ€å¾Œçš„ç”Ÿæˆçµæœè®“å¤§å®¶çœ‹ä¸€ä¸‹</p>
<pre><code class="language-dart">import 'package:flutter_day_21_tester/auth.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';

import 'loginWithEmailAndPassword.welltested_test.mocks.dart';

@GenerateMocks([User])
void main() {
late Auth auth;
late MockUser mockUser;

setUp(() {
auth = Auth();
mockUser = MockUser();
});

test('login with valid credentials', () async {
when(mockUser.uid).thenReturn('123456');
final result = await auth.loginWithEmailAndPassword(
email: 'test@test.com', password: 'password');
expect(result.uid, '123456');
});

test('login with empty email', () async {
expect(() async {
await auth.loginWithEmailAndPassword(email: '', password: 'password');
}, throwsException);
});

test('login with empty password', () async {
expect(() async {
await auth.loginWithEmailAndPassword(
email: 'test@test.com', password: '');
}, throwsException);
});

test('login with already logged in user', () async {
when(mockUser.uid).thenReturn('123');
final result = await auth.loginWithEmailAndPassword(
email: 'test@test.com', password: 'password');
expect(result.uid, '123');
});

test('login with invalid credentials', () async {
final result = await auth.loginWithEmailAndPassword(
email: 'invalid@test.com', password: 'invalidpassword');
expect(result.uid, '123');
});

test('login with non-email string', () async {
expect(() async {
await auth.loginWithEmailAndPassword(
email: 'notanemail', password: 'password');
}, throwsException);
});
}

</code></pre>
<p>WellTested ç®—æ˜¯å¾ˆé…·çš„å·¥å…·ï¼Œç”Ÿæˆçš„æ¸¬è©¦çœ‹èµ·ä¾†ä¹Ÿæœ‰æ¨¡æœ‰æ¨£çš„ï¼Œä¸éå› ç‚ºæˆ‘æ²’æœ‰æ·±å…¥ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ç¢ºå®šæ›´è¤‡é›œçš„ç‹€æ³æœƒä¸æœƒæœ‰ä»€éº¼å•é¡Œã€‚</p>
<p>ç›®å‰å°è©¬ç—…çš„åœ°æ–¹å°±æ˜¯æ–‡ä»¶æ›´æ–°çœ‹èµ·ä¾†ä¸å¤ªåŠæ™‚ï¼Œè€Œä¸” AI ç”Ÿæˆæ¸¬è©¦çš„æ™‚é–“é›–ç„¶ä¸é•·ä½†æ˜¯ä¹Ÿä¸ç®—å¤ªçŸ­ã€‚é«”æ„Ÿå¤§æ¦‚ 1~2 åˆ†é˜ï¼Œå¦‚æœä½ æœ‰ä¸€äº›é‚„æ²’æœ‰å¯«æ¸¬è©¦çš„åœ°æ–¹ï¼Œä¸å¦¨ä¾†è©¦ç”¨çœ‹çœ‹ã€‚</p>
<h2 id="3-mocking"><a class="header" href="#3-mocking">3. Mocking</a></h2>
<h3 id="mocktail-vs-mockito"><a class="header" href="#mocktail-vs-mockito">Mocktail vs Mockito</a></h3>
<p>å¦‚æœç¶“å¸¸å¯« Flutter æ¸¬è©¦ï¼Œé€™å…©å€‹å·¥å…·æ‡‰è©²å°±æ˜¯å¿…å‚™å…¶ä¸€äº†ã€‚é€™å…©å€‹å·¥å…·éƒ½æ˜¯ Flutter æ¸¬è©¦ä¸­æ¨¡æ“¬å°è±¡çš„é¦–é¸ã€‚Mockito æ˜¯æ¯”è¼ƒæ—©å‡ºä¾†çš„å·¥å…·ï¼Œæ‰€ä»¥ä½¿ç”¨çš„äººæ•¸è¼ƒå¤šï¼Œä¹Ÿæ›´å¤šå°ˆæ¡ˆæœ‰ä¾è³´ä»–ã€‚Mockito ä¾è³´æ–¼ Annotation ä»–éœ€è¦å…ˆå¹«è¦ Mock çš„ class åŠ ä¸Š <code>@GenerateNiceMocks</code> ****ï¼Œç„¶å¾Œé€é build_runner å»ç”¢ç”Ÿå°æ‡‰çš„ Mock classã€‚</p>
<p>ä½†å¦‚æœæ˜¯å°ˆæ¡ˆæ¯”è¼ƒå¤§çš„äººï¼Œå°±æœƒé–‹å§‹å° build_runner ç”¢ç”Ÿå®³æ€•ï¼Œå› ç‚ºå‹•è¼’éƒ½è¦è‡ªå‹•ç”Ÿæˆå¹¾åƒå€‹æª”æ¡ˆï¼Œå¯¦åœ¨æ˜¯èŠ±å¤ªå¤šæ™‚é–“ã€‚ Mocktail å°±æ˜¯çœ‹æº–é€™é»ï¼Œä»–å¯ä»¥ä¸é€é build_runner å»ç”Ÿæˆå°æ‡‰çš„é¡åˆ¥ï¼Œè€Œæ˜¯ç›´æ¥é€é extends æ­é… when ä¾†è¦†è“‹åŸæœ¬çš„æ–¹æ³•ï¼Œè®“ä½¿ç”¨ä¸Šæ›´å¿«é€Ÿç°¡ä¾¿ã€‚</p>
<p>æ¥ä¸‹ä¾†å¿«é€Ÿçœ‹çœ‹å…©é‚Šçš„ç¨‹å¼ç¢¼å°æ¯”ï¼š</p>
<h3 id="å»ºç«‹-mock-class"><a class="header" href="#å»ºç«‹-mock-class">å»ºç«‹ Mock Class:</a></h3>
<p>å·®åˆ¥åªåœ¨ä¸€å€‹ç”¨ Annotation å¦ä¸€å€‹ç›´æ¥ extends <code>Mock</code>ï¼Œä¸é Mockito é‚„æœƒç”Ÿæˆå¦å¤–ä¸€å€‹ <code>.mock.dart</code> çš„æª”æ¡ˆï¼Œæ‰€ä»¥æœƒæ›´ä¸éˆæ´»ä¸€é»ã€‚</p>
<p><strong>Mockito</strong></p>
<pre><code class="language-dart">import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';

// Annotation which generates the cat.mocks.dart library and the MockCat class.
@GenerateNiceMocks([MockSpec()])
import 'cat.mocks.dart';

// Real class
class Cat {
String sound() =&gt; "Meow";
bool eatFood(String food, {bool? hungry}) =&gt; true;
int lives = 9;
}

void main() {
// Create mock object.
var cat = MockCat();
}

</code></pre>
<p><strong>Mocktail</strong></p>
<pre><code class="language-dart">import 'package:mocktail/mocktail.dart';

// A Real Cat class
class Cat {
String sound() =&gt; 'meow!';
bool likes(String food, {bool isHungry = false}) =&gt; false;
final int lives = 9;
}

// A Mock Cat class
class MockCat extends Mock implements Cat {}

void main() {
// Create a Mock Cat instance
final cat = MockCat();
}

</code></pre>
<h3 id="verify-å’Œ-expect"><a class="header" href="#verify-å’Œ-expect">Verify å’Œ Expect</a></h3>
<p>åœ¨Flutterçš„å–®å…ƒæ¸¬è©¦ä¸­ï¼Œ<code>verify</code> å’Œ <code>expect</code> æ˜¯å…©å€‹å¸¸ç”¨ä¾†ç¢ºèªæ¨¡æ“¬ç‰©ä»¶è¡Œç‚ºå’Œçµæœçš„æ–¹æ³•ã€‚é€™äº›æ–¹æ³•é€šå¸¸èˆ‡Mockitoæˆ–Mocktailé€™æ¨£çš„æ¨¡æ“¬å‡½å¼åº«ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p><strong>expect</strong></p>
<p><code>expect</code> æ˜¯Flutteræ¸¬è©¦æ¡†æ¶ä¸­çš„ä¸€å€‹å‡½æ•¸ï¼Œç”¨æ–¼é©—è­‰æŸå€‹çµæœæ˜¯å¦ç¬¦åˆé æœŸã€‚å®ƒæ¥å—å…©å€‹åƒæ•¸ï¼šactual(å¯¦éš›çš„çµæœ) å’Œ matcher(é æœŸçš„çµæœæˆ–æ¢ä»¶)ã€‚</p>
<p>ä¾‹å­ä¸­ä½¿ç”¨ <code>expect(cat.sound(), 'Purr');</code> æ˜¯ç‚ºäº†ç¢ºèª <code>cat.sound()</code> çš„è¿”å›å€¼æ˜¯å¦ç‚º <code>'Purr'</code>ã€‚</p>
<p><strong>verify</strong></p>
<p>åœ¨Mockitoæˆ–Mocktailä¸­ï¼Œ<code>verify</code> æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œç”¨æ–¼ç¢ºèªæŸå€‹æ¨¡æ“¬æ–¹æ³•æ˜¯å¦è¢«èª¿ç”¨ï¼Œä»¥åŠè¢«èª¿ç”¨çš„æ¬¡æ•¸ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>verify(cat.sound()).called(2);</code> å’Œ <code>verify(() =&gt; cat.sound()).called(2);</code> åˆ†åˆ¥ç”¨æ–¼ç¢ºèª <code>cat.sound()</code> æ–¹æ³•è¢«èª¿ç”¨äº†å…©æ¬¡ã€‚</p>
<p><strong>Mockito</strong></p>
<pre><code class="language-dart">// Stub a mock method before interacting.
when(cat.sound()).thenReturn('Purr');
expect(cat.sound(), 'Purr');

verify(cat.sound()).called(2);

</code></pre>
<p><strong>Mocktail</strong></p>
<pre><code class="language-dart">// Stub a method before interacting with the mock.
when(() =&gt; cat.sound()).thenReturn('Purr');
expect(cat.sound(), 'Purr');

verify(() =&gt; cat.sound()).called(2);

</code></pre>
<p>Mockito å’Œ Mocktail å¯ä»¥å¾ä¸Šé¢ä¸­çš„å°æ¯”çŸ¥é“å…¶å¯¦å…©è€…çš„å·®ç•°ä¸¦æ²’æœ‰é‚£éº¼å¤§ï¼Œæ›´å¤šçš„å·®åˆ¥åœ¨æ–¼ä»–å€‘å…§éƒ¨å¦‚ä½•å¯¦ç¾é€™äº›æ–¹æ³•ã€‚é‚£è¬›åˆ°é€™è£¡ç›¸ä¿¡å¤§å®¶å¯èƒ½å¤šå°‘æœ‰é»å¥½å¥‡ Mocktail æ˜¯å¦‚ä½•åœ¨ä¸ç”¨ç”Ÿæˆæ–°çš„ class çš„æƒ…æ³ä¸‹å¯ä»¥åšåˆ°è¦†è“‹åŸæœ¬çš„æ–¹æ³•ã€‚é€™å°±å¿…é ˆè¦æåˆ° dart ä¸­ä¸€å€‹ä½ å¸¸è¦‹éå»ä¸çŸ¥é“ä»–ç«Ÿç„¶æœ‰é€™å€‹ç”¨é€”çš„æ–¹æ³•ï¼š<code>noSuchMethod</code></p>
<h3 id="mocktail-æ ¸å¿ƒè¬›è§£"><a class="header" href="#mocktail-æ ¸å¿ƒè¬›è§£">Mocktail æ ¸å¿ƒè¬›è§£</a></h3>
<h3 id="nosuchmethod"><a class="header" href="#nosuchmethod">noSuchMethod</a></h3>
<p>åœ¨ Dart ä¸­ï¼Œä½ å¯ä»¥é€šéè¦†è“‹ <code>noSuchMethod()</code> ä¾†è‡ªè¨‚å°è±¡å¦‚ä½•å›æ‡‰åœ¨å…¶ class chain ä¸­æ²’æœ‰æ˜ç¢ºå®šç¾©çš„æ–¹æ³•ã€‚ç™½è©±æ–‡å°±æ˜¯ï¼šåªè¦ override <code>noSuchMethod</code> å°±ç­‰æ–¼ä½ å¯ä»¥æ“ä½œä»»ä½•æ²’æœ‰æ˜ç¢ºå®šç¾©çš„æ–¹æ³•åšä»»åˆäº‹æƒ…ï¼ŒMocktail å°±æ˜¯å·§å¦™çš„åˆ©ç”¨é€™ä¸€é»ä¾†è¦†è“‹åŸæœ‰çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘å€‘ä¸€èµ·ä¾†æ¬£è³ä¸€ä¸‹é€™æ®µæœ€æ ¸å¿ƒçš„åŸå§‹ç¢¼</p>
<pre><code class="language-dart">@override
dynamic noSuchMethod(Invocation invocation) {
invocation = _useMatchedInvocationIfSet(invocation);
if (_whenInProgress) {
_whenCall = _WhenCall(this, invocation);
return null;
} else if (_verificationInProgress) {
_verifyCalls.add(_VerifyCall(this, invocation));
return null;
} else if (_untilCalledInProgress) {
_untilCall = _UntilCall(this, invocation);
return null;
} else {
_realCalls.add(RealCall(this, invocation));
_invocationStreamController.add(invocation);
final cannedResponse = _responses.lastWhere(
(response) {
return response.call.matches(invocation, {});
},
orElse: __defaultResponse,
);
return cannedResponse.response(invocation);
}
}

</code></pre>
<pre><code class="language-dart">dynamic noSuchMethod(Invocation invocation) {

</code></pre>
<p>é€™æ˜¯ä¸€å€‹è¦†å¯«çš„ <code>noSuchMethod</code> æ–¹æ³•ã€‚æ¯ç•¶åœ¨ Mock å°è±¡ä¸Šèª¿ç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æ™‚ï¼Œæ­¤æ–¹æ³•éƒ½æœƒè¢«è§¸ç™¼ã€‚</p>
<pre><code class="language-dart">invocation = _useMatchedInvocationIfSet(invocation);

</code></pre>
<p>å˜—è©¦ç²å–èˆ‡ç•¶å‰èª¿ç”¨åŒ¹é…çš„å·²è¨­ç½®çš„æ¨¡æ“¬è¡Œç‚ºï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰ã€‚</p>
<pre><code class="language-dart">if (_whenInProgress) {
_whenCall = _WhenCall(this, invocation);
return null;
}

</code></pre>
<p>å¦‚æœ <code>_whenInProgress</code> ç‚º <code>true</code>ï¼ˆè¡¨ç¤ºç•¶å‰æ­£åœ¨é€²è¡Œä¸€å€‹ <code>when</code> èª¿ç”¨ï¼‰ï¼Œå‰‡å®ƒå°‡å‰µå»ºä¸€å€‹æ–°çš„ <code>_WhenCall</code> å°è±¡ä»¥æ•ç²é€™æ¬¡èª¿ç”¨ï¼Œä¸¦å°‡å…¶å„²å­˜èµ·ä¾†ã€‚</p>
<pre><code class="language-dart">else if (_verificationInProgress) {
_verifyCalls.add(_VerifyCall(this, invocation));
return null;
}

</code></pre>
<p>å¦‚æœ <code>_verificationInProgress</code> ç‚º <code>true</code>ï¼Œå‰‡ä»£è¡¨æ­£åœ¨é€²è¡Œä¸€å€‹é©—è­‰æ“ä½œï¼ˆä¾‹å¦‚ <code>verify</code>ï¼‰ã€‚å®ƒæœƒå‰µå»ºä¸€å€‹æ–°çš„ <code>_VerifyCall</code> å°è±¡ä¾†æ•ç²é€™æ¬¡èª¿ç”¨ä¸¦å°‡å…¶åŠ å…¥ <code>_verifyCalls</code> åˆ—è¡¨ä¸­ã€‚</p>
<pre><code class="language-dart">else if (_untilCalledInProgress) {
_untilCall = _UntilCall(this, invocation);
return null;
}

</code></pre>
<p>å¦‚æœ <code>_untilCalledInProgress</code> ç‚º <code>true</code>ï¼Œé€™è¡¨ç¤ºæ­£åœ¨é€²è¡Œä¸€å€‹ <code>untilCalled</code> æ“ä½œã€‚å®ƒå°‡å‰µå»ºä¸€å€‹ <code>_UntilCall</code> å°è±¡ä¾†æ•ç²é€™æ¬¡èª¿ç”¨ã€‚</p>
<pre><code class="language-dart">else {
_realCalls.add(RealCall(this, invocation));
_invocationStreamController.add(invocation);

</code></pre>
<p>åœ¨å…¶ä»–æ‰€æœ‰æƒ…æ³ä¸‹ï¼ˆä¹Ÿå°±æ˜¯åœ¨ä¸€èˆ¬çš„æ–¹æ³•èª¿ç”¨ä¸­ï¼‰ï¼Œå®ƒå°‡é€™æ¬¡èª¿ç”¨è¦–ç‚ºä¸€å€‹çœŸå¯¦çš„èª¿ç”¨ (<code>RealCall</code>) ä¸¦å°‡å…¶å„²å­˜ã€‚å®ƒé‚„å°‡é€™æ¬¡èª¿ç”¨ç™¼é€åˆ° <code>_invocationStreamController</code>ï¼Œé€™å¯èƒ½ç”¨æ–¼å¾ŒçºŒçš„äº‹ä»¶è™•ç†æˆ–å…¶ä»–æ“ä½œã€‚</p>
<pre><code class="language-dart">final cannedResponse = _responses.lastWhere(
(response) {
return response.call.matches(invocation, {});
},
orElse: __defaultResponse,
);
return cannedResponse.response(invocation);

</code></pre>
<p>æ¥è‘—ï¼Œå®ƒå°‡å°‹æ‰¾ä¸€å€‹å·²è¨­ç½®çš„æ¨¡æ“¬å›æ‡‰ (<code>cannedResponse</code>)ï¼Œé€™å€‹å›æ‡‰æ‡‰è©²åŒ¹é…ç•¶å‰çš„èª¿ç”¨ã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œå®ƒæœƒè¿”å›è©²æ¨¡æ“¬å›æ‡‰ï¼›å¦‚æœæ²’æœ‰æ‰¾åˆ°ï¼Œå‰‡è¿”å›ä¸€å€‹é è¨­çš„å›æ‡‰ã€‚</p>
<p>ç¸½ä¹‹ï¼Œé€™å€‹ <code>noSuchMethod</code> æ–¹æ³•çš„ç›®çš„æ˜¯æ•ç²å°æ¨¡æ“¬å°è±¡çš„æ‰€æœ‰æ–¹æ³•èª¿ç”¨ï¼Œä¸¦æ ¹æ“šç•¶å‰çš„ç‹€æ…‹ï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¦æ­£åœ¨åŸ·è¡Œ <code>when</code> æˆ– <code>verify</code> æ“ä½œï¼‰æ±ºå®šå¦‚ä½•å›æ‡‰ã€‚é€™å°±æ˜¯ <code>Mocktail</code> å¦‚ä½•æ¨¡æ“¬æ–¹æ³•èª¿ç”¨ä¸¦å…è¨±ä½ è¨­å®šæœŸæœ›å’Œé©—è­‰èª¿ç”¨çš„æ–¹å¼ã€‚å¸Œæœ›å¤§å®¶æœ‰å­¸åˆ°æ–°æ±è¥¿ï¼ˆé›–ç„¶æ˜æ˜æ˜¯è¦è¬›æ¸¬è©¦çš„ï¼¸ï¼¤ï¼‰</p>
<h2 id="ç¸½çµ"><a class="header" href="#ç¸½çµ">ç¸½çµ</a></h2>
<p>ç¸½çµä¾†èªªï¼Œç„¡è«–æ˜¯å¾å½é€ æ¸¬è©¦è³‡æ–™çš„ Faker åˆ°è‡ªå‹•ç”Ÿæˆæ¸¬è©¦çš„ Walltestedï¼Œå†åˆ°æ¨¡æ“¬å°è±¡çš„ Mocktail å’Œ Mockitoï¼Œæ¯ä¸€å€‹å·¥å…·éƒ½ç‚ºæˆ‘å€‘çš„æ¸¬è©¦æä¾›äº†ä¸å°‘åŠ©åŠ›ã€‚è€Œ Dart ä¸­çš„ <code>noSuchMethod</code> çœŸçš„æ˜¯ä¸€å€‹çœ¼ç›ä¸€äº®çš„ç‰¹æ€§ï¼Œå……åˆ†å±•ç¤ºäº† Dart èªè¨€çš„é­…åŠ›ã€‚é›–ç„¶èªªåœ¨é–‹ç™¼çš„éç¨‹ä¸­ï¼Œæœ‰äº›äººå¯èƒ½å°æ¸¬è©¦æ„Ÿåˆ°å®³æ€•ï¼Œä½†æœ‰äº†é€™äº›å·¥å…·ï¼Œè‡³å°‘æˆ‘å€‘å¯ä»¥èªªï¼Œã€Œæ¸¬è©¦ï¼Œä¹Ÿæ²’é‚£éº¼å¯æ€•ï¼ã€ã€‚å¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½ç‚ºå¤§å®¶çš„ Flutter çš„æ¸¬è©¦ä¹‹æ—…å¸¶ä¾†ä¸€é»å•Ÿç¤ºå’Œä¾¿åˆ©ï¼æ˜å¤©è¦‹ï½</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="day50.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="day52.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="day50.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="day52.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
